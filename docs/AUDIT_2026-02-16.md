# CookiePeek Security Audit Report (2026-02-16)

## Scope
- Repository: `cookiepeek`
- Target: browser extension source (`src/**`), manifest config (`wxt.config.ts`), production manifest output (`dist/chrome-mv3/manifest.json`)
- Method: static review + checklist from `docs/TESTING.md` + local verification commands

## Executed Checks

1. `npm run check` — typecheck, lint, and unit tests.
2. `npm run build` — production Chrome build.
3. `npm audit --omit=dev` — runtime dependency vulnerability scan.
4. Code search for risky primitives and possible exfiltration channels:
   - `fetch(`, `XMLHttpRequest`, `WebSocket`, `sendBeacon`
   - `eval(`, `new Function(`, `innerHTML =`
   - storage usage and permission surface

## Findings

### ✅ F1 — No outbound network APIs in extension code
Search over `src/**` found no usage of `fetch`, `XMLHttpRequest`, `WebSocket`, or `sendBeacon`.

Risk: **Low**

### ✅ F2 — No dynamic code execution (`eval`/`Function`)
No `eval` or `Function` constructor usage found.

Risk: **Low**

### ✅ F3 — `innerHTML` usage appears safe (DOM clearing only)
`innerHTML` is used to clear containers (`''`) rather than inject untrusted cookie values.

Risk: **Low**

### ⚠️ F4 — Broad host access by design (`<all_urls>`)
Manifest host permissions include `<all_urls>`, which is functionally expected for cross-site cookie inspection, but this increases blast radius if extension logic is compromised.

Risk: **Medium (design tradeoff)**

Recommendation:
- Keep this as-is for product requirements, but document justification explicitly in store submission and security docs.

### ⚠️ F5 — `storage` permission appears over-provisioned
Manifest requests `storage`; currently cookie data is not persisted through extension storage in source checks (theme uses `localStorage` in popup context). Permission may be unnecessary unless planned for future settings.

Risk: **Low/Medium (principle of least privilege)**

Recommendation:
- Remove `storage` permission if not required, or migrate theme preference to extension storage and keep permission with clear rationale.

### ⚠️ F6 — CSP is implicit in built MV3 manifest
Built Chrome manifest does not declare explicit `content_security_policy`. MV3 applies default extension CSP, which is usually safe, but explicit declaration can improve auditability.

Risk: **Low**

Recommendation:
- Optionally define explicit extension pages CSP in config for clarity.

## Validation Summary

- Quality gate: **PASS** (`npm run check`)
- Unit tests: **PASS** (42/42)
- Build: **PASS** (`wxt build`)
- Runtime dependency audit: **PASS** (`npm audit --omit=dev`)
- Full `npm audit`: **WARN** (registry endpoint returned 403 in this environment)

## Overall Assessment

Current codebase matches the declared “zero telemetry / local-only processing” model and does not show obvious exfiltration or dynamic-code risks.

Primary remaining concerns are **permission scope** (`<all_urls>` and possibly redundant `storage`) and **documentation clarity** around CSP/permission rationale.

## Recommended Next Actions

1. Decide whether `storage` permission is truly needed now; remove if not.
2. Add a short “permission rationale” section to release docs/store listing.
3. Optionally make CSP explicit in `wxt.config.ts` for stronger audit trail.
